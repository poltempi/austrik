---
import BaseLayout from "../layouts/BaseLayout.astro";
import { fetchAllPosts } from "../services/posts";

Astro.response.headers.set('Cache-Control', 'no-store, max-age=0');

let posts = [] as Awaited<ReturnType<typeof fetchAllPosts>>;
try {
  posts = await fetchAllPosts();
} catch (e) {
  console.error('Home fetchAllPosts error:', e);
  posts = [];
}
---

<BaseLayout title="Austrik Blog" description="Noticias y artículos de Austrik">
  <h1 style="margin-top:0">Austrik Blog</h1>
  {posts.length === 0 && (
    <p>No hay posts todavía o hay un problema temporal con la conexión a datos.</p>
  )}
  <ul style="list-style:none; padding:0; display:grid; gap:1.25rem;">
    {posts.map((p) => (
      <li>
        <a href={`/posts/${p.slug}/`} style="text-decoration:none; color:inherit;">
          <article style="border:1px solid #e5e7eb; border-radius:8px; padding:1rem;">
            <h2 style="margin:0 0 .5rem 0;">{p.title}</h2>
            {p.excerpt && <p style="margin:.25rem 0 0 0; color:#4b5563;">{p.excerpt}</p>}
            {p.published_at && <small style="color:#6b7280;">{new Date(p.published_at).toLocaleDateString('es')}</small>}
          </article>
        </a>
      </li>
    ))}
  </ul>
</BaseLayout>
